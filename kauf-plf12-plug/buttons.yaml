# Allow importing of this package
dashboard_import:
  package_import_url: "github://Marsupilami23/myesphometemplates/kauf-plf12-plug/buttons.yaml@main"
  import_full_config: false

  # https://esphome.io/components/button/index.html
# https://esphome.io/components/button/restart.html
button:
  - platform: restart
    id: restart_button
    name: $friendly_name Restart Firmware
    entity_category: diagnostic
    disabled_by_default: $disable_entities

# https://esphome.io/components/select/index.html
# https://esphome.io/components/select/template.html
select:

  - platform: template
    name: $friendly_name Button Config
    id: select_button
    optimistic: true
    options:
      - Toggle on Press
      - Toggle on Release
      - Don't Toggle
    initial_option: $default_button_config
    restore_value: true
    icon: mdi:circle-double
    entity_category: config
    forced_hash: 3616613943
    forced_addr: 34
    global_addr: global_forced_addr
    set_action:
      - script.execute: script_save_changes

  - platform: template
    name: $friendly_name Blue LED Config
    id: select_bled
    optimistic: true
    entity_category: config
    options:
      - Power Status
      - No Automation
      - Invert Power Status
      - Error Status
      - Error and Power
      - Error and Invert Power
    initial_option: Power Status
    restore_value: true
    icon: mdi:led-on
    forced_hash: 3104663617
    forced_addr: 36
    global_addr: global_forced_addr
    set_action:
      - script.execute: script_save_changes
    on_value:
      - if:
          condition:
            - lambda: return ( x == "Error Status" );
          then:
            - switch.turn_off: blue_led
      - script.execute: script_set_power_leds

  - platform: template
    name: $friendly_name Red LED Config
    id: select_rled
    optimistic: true
    entity_category: config
    options:
      - Power Status
      - No Automation
      - Invert Power Status
      - Error Status
      - Error and Power
      - Error and Invert Power
    initial_option: Error Status
    restore_value: true
    icon: mdi:led-on
    forced_hash: 261191305
    forced_addr: 38
    global_addr: global_forced_addr
    set_action:
      - script.execute: script_save_changes
    on_value:
      - if:
          condition:
            - lambda: return ( x == "Error Status" );
          then:
            - switch.turn_off: red_led
      - script.execute: script_set_power_leds

  # change update interval for power monitoring sensors
  - platform: template
    name: $friendly_name Monitoring Update Interval
    id: select_monitor_interval
    optimistic: true
    options:
      - 60s
      - 30s
      - 10s
      - 5s
      - 2s
      - YAML Configured ($sub_update_interval)
    initial_option: $sub_pm_initial_option
    restore_value: true
    icon: mdi:wrench-clock
    entity_category: config
    disabled_by_default: $disable_entities
    forced_hash: 1025003091
    forced_addr: 0
    global_addr: global_forced_addr
    set_action:
      - script.execute: script_save_changes
      - script.execute: script_setting_reboot
    on_value:
      - lambda: |-
          if      ( x == "60s" ) { id(hlw_main).set_update_interval(60000); }
          else if ( x == "30s" ) { id(hlw_main).set_update_interval(30000); }
          else if ( x == "10s" ) { id(hlw_main).set_update_interval(10000); }
          else if ( x == "5s"  ) { id(hlw_main).set_update_interval(5000); }
          else if ( x == "2s"  ) { id(hlw_main).set_update_interval(2000); }

  - platform: template
    name: $friendly_name Boot State
    id: select_boot_state
    optimistic: true
    options:
      - "Restore Power Off State"
      - "Invert Power Off State"
      - "Always On"
      - "Always Off"
      - "YAML Configured ($sub_restore_mode)"
    initial_option: "Restore Power Off State"
    restore_value: true
    icon: mdi:restart-alert
    entity_category: config
    forced_hash: 2390278151
    forced_addr: 74
    global_addr: global_forced_addr
    on_value:
      - lambda: |-
          if ( x == "Restore Power Off State")
            relay->set_restore_mode(SWITCH_RESTORE_DEFAULT_OFF);
          else if ( x == "Invert Power Off State")
            relay->set_restore_mode(SWITCH_RESTORE_INVERTED_DEFAULT_OFF);
          else if ( x == "Always On")
            relay->set_restore_mode(SWITCH_ALWAYS_ON);
          else if ( x == "Always Off")
            relay->set_restore_mode(SWITCH_ALWAYS_OFF);
          else
            relay->set_restore_mode(SWITCH_$sub_restore_mode);

          // republish state so it gets saved if necessary
          // but make sure relay already set up, don't want to publish here on boot
          if ( id(relay).is_setup() ) id(relay).publish_state(id(relay).state, true);

      - script.execute: script_save_changes
